<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>p5 Tilt-Scale Letters in Two Words</title>
    <script src="https://unpkg.com/p5@1.6.0/lib/p5.min.js"></script>
    <script src="https://unpkg.com/p5@1.6.0/lib/addons/p5.dom.min.js"></script>
    <style>
      body { margin:0; overflow:hidden; }
      #motionBtn {
        position: absolute;
        top: 1rem; left: 50%;
        transform: translateX(-50%);
        padding: .5rem 1rem;
        font-size: 1rem;
        z-index: 10;
      }
    </style>
  </head>
  <body>
    <button id="motionBtn">Enable Motion Effects</button>
    <script>
      // === CONFIG ===
      let words         = ['if','no'];
      let baseFontSize  = 164;
      let maxScale      = 5;    // letter grows up to this
      let minScale      = 0.7;  // others shrink down to this
      let smoothing     = 0.1;

      // Flatten letters into array with row/col info
      let letters = [];
      words.forEach((w, row) => {
        for (let col = 0; col < w.length; col++) {
          letters.push({
            char: w[col],
            row: row,
            col: col,
            baseScale: 1,
            targetScale: 1
          });
        }
      });
      let cols = words[0].length; // assumes all words same length

      // — Motion / Permission Logic —
      let permissionGranted = false;
      const deadZone        = 1,
            smoothingFactor = 0.15,
            updateInterval  = 50,
            maxTilt         = 45;  // degrees

      let lastScale   = 1,
          lastTiltLR  = 0,
          lastUpdate  = 0;

      function requestMotionPermission() {
        if (typeof DeviceOrientationEvent !== 'undefined'
         && typeof DeviceOrientationEvent.requestPermission === 'function') {
          DeviceOrientationEvent.requestPermission()
            .then(r => {
              if (r === 'granted') enableMotion();
              else              console.warn('Motion permission denied');
            })
            .catch(console.error);
        } else enableMotion();
      }

      function enableMotion() {
        permissionGranted = true;
        select('#motionBtn').hide();
        window.addEventListener('deviceorientation', handleOrientation);
      }

      function handleOrientation(evt) {
        if (!permissionGranted) return;
        let tilt = evt.gamma;
        if (abs(tilt) < deadZone) return;

        let now = Date.now();
        if (now - lastUpdate < updateInterval) return;
        lastUpdate = now;
        lastTiltLR = tilt;

        let t = constrain(abs(tilt) / maxTilt, 0, 1);
        let raw = 1 + t * (maxScale - 1);
        lastScale += smoothingFactor * (raw - lastScale);
      }
      // ——————————————————————

      function setup() {
        createCanvas(windowWidth, windowHeight);
        textSize(baseFontSize);
        textAlign(LEFT, BASELINE);
        textStyle(BOLD);
        textLeading(baseFontSize * 1.2);
        select('#motionBtn').mousePressed(requestMotionPermission);
      }

      function draw() {
        background(255);

        // pick which column to “hover” based on tilt sign
        // tilt<0 → col 0, tilt>0 → col last
        let colIdx = lastTiltLR < 0 ? 0 : cols - 1;

        // set targetScale
        letters.forEach(L => {
          if (L.col === colIdx) {
            L.targetScale = lastScale;
          } else {
            L.targetScale = map(
              lastScale,
              1, maxScale,
              1, minScale,
              true
            );
          }
        });

        // lerp current toward target
        letters.forEach(L => {
          L.baseScale = lerp(L.baseScale, L.targetScale, smoothing);
        });

        // draw letters in a centered column
        push();
          translate(width / 2, height / 2);
          for (let row = 0; row < words.length; row++) {
            // collect this row’s letters
            let rowLetters = letters.filter(L => L.row === row);
            // compute total row width
            let totalW = rowLetters.reduce((sum, L) =>
              sum + textWidth(L.char) * L.baseScale, 0);
            // start x so row is centered
            let x = -totalW / 2;
            let y = (row - (words.length - 1)/2) * textLeading();
            // draw each letter
            rowLetters.forEach(L => {
              push();
                translate(x, y);
                scale(L.baseScale, 1);
                text(L.char, 0, 0);
              pop();
              x += textWidth(L.char) * L.baseScale;
            });
          }
        pop();
      }

      function windowResized(){
        resizeCanvas(windowWidth, windowHeight);
      }
    </script>
  </body>
</html>
