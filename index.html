<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>p5 tilt-scale letters</title>
    <script src="https://unpkg.com/p5@1.6.0/lib/p5.min.js"></script>
    <script src="https://unpkg.com/p5@1.6.0/lib/addons/p5.dom.min.js"></script>
  </head>
  <body>
    <button id="motionBtn">Enable Motion Effects</button>
    <script>
      let word = 'hastory';
      let baseFontSize = 114;
      let baseScales = [];
      let targetScales = [];
      let smoothing = 0.1;
      let maxScale = 5;    // how big the “hovered” letter can grow
      let minScale = 0.7;  // how small the others shrink

      // — Motion / Permission Logic —
      let permissionGranted = false;
      const deadZone        = 1,
            smoothingFactor = 0.15,
            updateInterval  = 50,
            maxTilt         = 45;  // degrees of gamma you care about

      let lastScale     = 1,
          lastTiltLR    = 0,
          lastUpdate    = 0;

      function requestMotionPermission() {
        if (typeof DeviceOrientationEvent !== 'undefined'
         && typeof DeviceOrientationEvent.requestPermission === 'function') {
          DeviceOrientationEvent.requestPermission()
            .then(r => {
              if (r === 'granted') enableMotion();
              else              console.warn('Motion permission denied');
            })
            .catch(console.error);
        } else {
          // no permission API, so just enable
          enableMotion();
        }
      }

      function enableMotion() {
        permissionGranted = true;
        select('#motionBtn').hide();
        window.addEventListener('deviceorientation', handleOrientation);
      }

      function handleOrientation(evt) {
        if (!permissionGranted) return;
        let tilt = evt.gamma;             // left/right tilt
        if (abs(tilt) < deadZone) return; // ignore tiny shakes

        let now = Date.now();
        if (now - lastUpdate < updateInterval) return;
        lastUpdate = now;
        lastTiltLR = tilt;

        // normalize magnitude 0→1
        let t = constrain(abs(tilt) / maxTilt, 0, 1);
        // map to scale range 1→maxScale
        let raw = 1 + t*(maxScale - 1);
        // smooth it
        lastScale += smoothingFactor * (raw - lastScale);
      }
      // ——————————————————————————————

      function setup() {
        createCanvas(800, 200);
        textSize(baseFontSize);
        textAlign(LEFT, BASELINE);
        textStyle(BOLD);

        // init
        for (let i = 0; i < word.length; i++) {
          baseScales[i] = 1;
          targetScales[i] = 1;
        }
        select('#motionBtn').mousePressed(requestMotionPermission);
      }

      function draw() {
        background(255);

        // 1) pick a “hover” index from tilt direction
        //    tilt<0 → left side (idx 0), tilt>0 → right side (idx end)
        //    here we map gamma in [-maxTilt..+maxTilt] to [0..word.length-1]
        let idx = floor(map(lastTiltLR, -maxTilt, maxTilt, 0, word.length));
        idx = constrain(idx, 0, word.length - 1);

        // 2) set target scales
        for (let i = 0; i < word.length; i++) {
          if (i === idx) {
            targetScales[i] = lastScale;
          } else {
            targetScales[i] = map(
              lastScale, 
              1, maxScale,  // input range
              1, minScale,  // output range
              true          // clamp
            );
          }
        }

        // 3) lerp toward targets
        for (let i = 0; i < word.length; i++) {
          baseScales[i] = lerp(baseScales[i], targetScales[i], smoothing);
        }

        // 4) draw
        let x = 50;
        translate(0, height / 2);
        for (let i = 0; i < word.length; i++) {
          let w = textWidth(word[i]) * baseScales[i];
          push();
            translate(x, 0);
            scale(baseScales[i], 1);
            text(word[i], 0, 0);
          pop();
          x += w;
        }
      }
    </script>
  </body>
</html>
